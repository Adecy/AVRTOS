; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = BlinkingLED

src_dir = src
include_dir = src

#_____________________________________________________________________________#

# Global configuration for ATmega328p and Arduino Pro

[env]
platform = atmelavr
board = megaatmega2560
; board = megaatmega2560, pro16MHzatmega328

; Build options debug/release
; build_type = debug

build_src_filter =
    +<avrtos/>

build_flags = 
    ; -Wl,-T./arch/avr/avrtos-avr5.xn
    -Wl,-T./arch/avr/avrtos-avr6.xn   

; /dev/ttyACM0
upload_port = /dev/ttyACM0

; /dev/ttyACM0
monitor_port = /dev/ttyACM0
monitor_speed = 500000

build_type = debug

#_____________________________________________________________________________#

[env:BlinkingLED]
build_src_filter =
    ${env.build_src_filter}
    +<examples/blinking-led/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=0
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_THREAD_IDLE=1
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=0

#_____________________________________________________________________________#

[env:CoopMultithreadingDemo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/coop-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x100
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=0
    -DCONFIG_THREAD_IDLE_COOPERATIVE=1

#_____________________________________________________________________________#

[env:QEMU-CoopMultithreadingDemo]

build_src_filter =
    ${env:CoopMultithreadingDemo.build_src_filter}

build_flags = 
    ${env:CoopMultithreadingDemo.build_flags}
    -D__QEMU__=1

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:MultithreadingSwitchingFrequencyDemo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/multithreading-switching-frequency/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=0
    
#_____________________________________________________________________________#

[env:PremptMultithreadingDemo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/prempt-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=250000
    -DCONFIG_KERNEL_DEBUG=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_DEBUG_PREEMPT_UART=1


# https://docs.platformio.org/en/latest/core/userguide/device/cmd_monitor.html#filters
# default, log2file
monitor_filters = direct  #, log2file

#_____________________________________________________________________________#

[env:DataStructures]
build_src_filter =
    ${env.build_src_filter}
    +<examples/data-structures/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=0

#_____________________________________________________________________________#

[env:MutexMultithreadingDemo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/mutex-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=4000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_THREAD_IDLE=1

#_____________________________________________________________________________#

[env:MutexMultithreadingDemo-qemu-ATmega328p]
build_type = debug

build_src_filter =
    ${env.build_src_filter}
    +<examples/mutex-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=200000
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_DEBUG=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=1
    -DCONFIG_KERNEL_THREAD_IDLE=1

debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main
    
#_____________________________________________________________________________#

[env:MutexMultithreadingDemoAssert]
build_src_filter =
    ${env.build_src_filter}
    +<examples/mutex-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=16000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_THREAD_IDLE=0
    -DCONFIG_KERNEL_ASSERT=1

#_____________________________________________________________________________#

[env:MutexMultithreadingTest]
build_src_filter =
    ${env.build_src_filter}
    +<examples/mutex-multithreading-test/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=16000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

#_____________________________________________________________________________#

[env:SemaphoreMultithreadingDemo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/semaphore-multithreading-demo/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=16000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

#_____________________________________________________________________________#

[env:Canaries]
build_src_filter =
    ${env.build_src_filter}
    +<examples/canaries/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
#_____________________________________________________________________________#

[env:InterruptYield]
build_src_filter =
    ${env.build_src_filter}
    +<examples/interrupt-yield/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=16000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_API_NOINLINE=0

#_____________________________________________________________________________#

[env:SchedLock]
build_src_filter =
    ${env.build_src_filter}
    +<examples/sched-lock/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=5000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_API_NOINLINE=1

#_____________________________________________________________________________#

[env:WorkQueue]
build_src_filter =
    ${env.build_src_filter}
    +<examples/workqueue/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

#_____________________________________________________________________________#

[env:SystemWorkQueue]
build_src_filter =
    ${env.build_src_filter}
    +<examples/system-workqueue/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_SYSTEM_WORKQUEUE_ENABLE=1
    -DCONFIG_KERNEL_API_NOINLINE=0

#_____________________________________________________________________________#

[env:Sysclock]
build_src_filter =
    ${env.build_src_filter}
    +<examples/sysclock/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=0
    -DCONFIG_KERNEL_TIME_SLICE_US=250000
    -DCONFIG_KERNEL_UPTIME=0
    -DCONFIG_KERNEL_DEBUG=1
    
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

#_____________________________________________________________________________#

[env:Sysclock-qemu-ATmega2560]
board = megaatmega2560

build_src_filter =
    ${env.build_src_filter}
    +<examples/sysclock/>

build_flags = 
    -Wl,-T./avrtos-avr6.xn

    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=250000
    -DCONFIG_KERNEL_UPTIME=0
    -DCONFIG_KERNEL_DEBUG=1
    
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

; build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:Sysclock-qemu-ATmega328p]
board = pro16MHzatmega328

build_src_filter =
    ${env.build_src_filter}
    +<examples/sysclock/>

build_flags = 
    -Wl,-T./avrtos-avr5.xn

    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=250000
    -DCONFIG_KERNEL_UPTIME=0
    -DCONFIG_KERNEL_DEBUG=1
    
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

; build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:MinimalExample]
build_src_filter =
    ${env.build_src_filter}
    +<examples/minimal-example/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_TIME_SLICE_US=10000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0

#_____________________________________________________________________________#

[env:Fifo]
build_src_filter =
    ${env.build_src_filter}
    +<examples/fifo/>

#_____________________________________________________________________________#

[env:FifoQemuMega328p]
board = pro16MHzatmega328

build_src_filter =
    ${env:Fifo.build_src_filter}
    
build_flags = 
    -Wl,-T./avrtos-avr5.xn
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1

debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:FifoSlab]
build_src_filter =
    ${env.build_src_filter}
    +<examples/fifo-slab/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=4000
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_ASSERT=0

#_____________________________________________________________________________#

[env:ObjectReservation]
build_src_filter =
    ${env.build_src_filter}
    +<examples/object-reservation/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_SYSCLOCK_PERIOD_US=1000000
    -DCONFIG_KERNEL_TIME_SLICE_US=1000000
    -DCONFIG_KERNEL_UPTIME=0
    -DCONFIG_KERNEL_DEBUG=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=1
    -DCONFIG_KERNEL_ASSERT=1

#_____________________________________________________________________________#

[env:ThreadTermination]
build_src_filter =
    ${env.build_src_filter}
    +<examples/thread-termination/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_UPTIME=0

#_____________________________________________________________________________#

[env:ThreadTermination-qemu-ATmega2560]
board = megaatmega2560

build_src_filter =
    ${env.build_src_filter}
    +<examples/thread-termination/>

build_flags = 
    -Wl,-T./avrtos-avr6.xn
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=1000000
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_UPTIME=0

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:Timer]
build_src_filter =
    ${env.build_src_filter}
    +<examples/timers/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=10000
    -DCONFIG_KERNEL_TIMERS=1
    -DCONFIG_SYSTEM_WORKQUEUE_ENABLE=1
    -DCONFIG_MAIN_STARTUP_INTERRUPT_POLICY=1
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=0x60

[env:Timer-qemu-ATmega2560]
build_src_filter =
    ${env.build_src_filter}
    +<examples/timers/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_STACK_SENTINEL=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=10000
    -DCONFIG_KERNEL_TIMERS=1
    -DCONFIG_SYSTEM_WORKQUEUE_ENABLE=1
    -DCONFIG_MAIN_STARTUP_INTERRUPT_POLICY=1
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=0x60
    -D__QEMU__=1

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:CPP]
build_src_filter =
    ${env.build_src_filter}
    +<examples/cpp/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=0
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=50000
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_KERNEL_DEBUG=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=1

#_____________________________________________________________________________#

[env:Signal]
build_src_filter =
    ${env.build_src_filter}
    +<examples/signal/>

build_flags = 
    ${env.build_flags}
    ; -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_DEBUG=0

#_____________________________________________________________________________#

[env:MemSlab]
build_src_filter =
    ${env.build_src_filter}
    +<examples/mem_slab/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x80
    -DCONFIG_THREAD_STACK_SENTINEL=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_UPTIME=1

#_____________________________________________________________________________#

[env:POC-Shell]
build_src_filter =
    ${env.build_src_filter}
    +<examples/poc-shell/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x100
    ; -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=0x60

#_____________________________________________________________________________#

[env:PRNG]
build_src_filter =
    ${env.build_src_filter}
    +<examples/prng/>

#_____________________________________________________________________________#

[env:MsgQ]
build_src_filter =
    ${env.build_src_filter}
    +<examples/msgq/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x64

#_____________________________________________________________________________#

[env:Atomic]
build_src_filter =
    ${env.build_src_filter}
    +<examples/atomic/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_KERNEL_ATOMIC_API=1

#_____________________________________________________________________________#

[env:IDLE]
build_src_filter =
    ${env.build_src_filter}
    +<examples/idle/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_THREAD_IDLE=0
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0

#_____________________________________________________________________________#

[env:Uptime]
build_src_filter =
    ${env.build_src_filter}
    +<examples/uptime/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=0
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=4000
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_API_NOINLINE=1
    -DCONFIG_THREAD_CANARIES=1

#_____________________________________________________________________________#

[env:Uptime-qemu-ATmega2560]
board = megaatmega2560

build_src_filter =
    ${env.build_src_filter}
    +<examples/uptime/>

build_flags = 
    -Wl,-T./avrtos-avr6.xn
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_API_NOINLINE=1
    -DCONFIG_THREAD_CANARIES=1

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:Footprint]
build_src_filter =
    ${env.build_src_filter}
    +<examples/footprint/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_THREAD_IDLE=0
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=0
    -DCONFIG_STDIO_PRINTF_TO_USART=-1
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_MAIN_STARTUP_INTERRUPT_POLICY=1
    
#_____________________________________________________________________________#

[env:Events]
build_src_filter =
    ${env.build_src_filter}
    +<examples/events/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_THREAD_IDLE=0
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x80
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_TIMERS=0
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_EVENTS=1

    -DCONFIG_KERNEL_TIME_SLICE_US=1000
    -DCONFIG_KERNEL_ASSERT=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_THREAD_STACK_SENTINEL=1
    -DCONFIG_KERNEL_API_NOINLINE=1
    
#_____________________________________________________________________________#

[env:StackSentinel]
build_src_filter =
    ${env.build_src_filter}
    +<examples/stack-sentinel/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_THREAD_IDLE=1
    -DCONFIG_THREAD_IDLE_COOPERATIVE=1
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x100
    -DCONFIG_THREAD_MAIN_COOPERATIVE=0

    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_TIMERS=0
    -DCONFIG_KERNEL_EVENTS=0

    -DCONFIG_KERNEL_SYSCLOCK_PERIOD_US=500
    -DCONFIG_KERNEL_TIME_SLICE_US=500
    -DCONFIG_KERNEL_ASSERT=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_THREAD_STACK_SENTINEL=1
    -DCONFIG_THREAD_STACK_SENTINEL_SIZE=1
    -DCONFIG_THREAD_STACK_SENTINEL_SYMBOL=0xFF
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=0x100
    -DCONFIG_KERNEL_UPTIME=1

#_____________________________________________________________________________#

[env:QEMU-StackSentinel]
build_src_filter =
	${env:StackSentinel.build_src_filter}

build_flags = 
	${env:StackSentinel.build_flags}
	-D__QEMU__=1

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main
    
#_____________________________________________________________________________#

[env:Time]
build_src_filter =
    ${env.build_src_filter}
    +<examples/time/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1
    -DCONFIG_KERNEL_TIME_SLICE_US=4000
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_API_NOINLINE=0
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_TIME=1

#_____________________________________________________________________________#

[env:V2]
build_src_filter =
    ${env.build_src_filter}
    +<examples/v2/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_ASSERT=1

    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_THREAD_STACK_SENTINEL=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_TIME=1
    -DCONFIG_THREAD_CANARIES=0

    -DCONFIG_KERNEL_SYSCLOCK_PERIOD_US=100000
    -DCONFIG_KERNEL_TIME_SLICE_US=100000
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=1

    -DCONFIG_KERNEL_THREAD_IDLE=1
    -DCONFIG_KERNEL_API_NOINLINE=0
    -DCONFIG_KERNEL_PREEMPTIVE_THREADS=1
    -DCONFIG_KERNEL_DEBUG_PREEMPT_UART=0

[env:V2-01]
build_src_filter =
	${env:V2.build_src_filter}

build_flags = 
	${env:V2.build_flags}
	-O1

[env:V2-02]
build_src_filter =
	${env:V2.build_src_filter}

build_flags = 
	${env:V2.build_flags}
	-O2
	
#_____________________________________________________________________________#

[env:QEMU-V2]
build_src_filter =
	${env:V2.build_src_filter}

build_flags = 
	${env:V2.build_flags}
	-D__QEMU__=1

board = pro16MHzatmega328

build_type = debug
debug_tool = custom
debug_port = :1234
debug_load_mode = manual
monitor_port = socket://localhost:5678
debug_extra_cmds =
    tbreak main

#_____________________________________________________________________________#

[env:DriversUsartAsync]
build_src_filter =
    ${env.build_src_filter}
    +<examples/drv-usart-async/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x100
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=50
    -DCONFIG_DRIVERS_USART1_ASYNC=1
    -DCONFIG_SYSTEM_WORKQUEUE_ENABLE=1
    -DCONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=0x200

#_____________________________________________________________________________#

[env:ZephyrDevUsartTool]
build_src_filter =
    ${env.build_src_filter}
    +<examples/zephyr-dev-usart-tool/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=1
    -DCONFIG_THREAD_MAIN_STACK_SIZE=0x100
    -DCONFIG_THREAD_CANARIES=1
    -DCONFIG_KERNEL_DEBUG=0
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
;     -DCONFIG_KERNEL_ASSERT=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_THREAD_IDLE_ADD_STACK=50
    -DCONFIG_SYSTEM_WORKQUEUE_ENABLE=1
    -DCONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=0x200
    -DCONFIG_DRIVERS_USART1_ASYNC=1

#_____________________________________________________________________________#

[env:DriversTimers]
build_src_filter =
    ${env.build_src_filter}
    +<examples/drv-timers/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_THREAD_EXPLICIT_MAIN_STACK=0
    -DCONFIG_KERNEL_THREAD_IDLE=0
    -DCONFIG_MAIN_STARTUP_INTERRUPT_POLICY=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0

    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=2
    -DCONFIG_KERNEL_TIME_SLICE_US=4000
    -DCONFIG_KERNEL_SYSCLOCK_PERIOD_US=1000
    -DCONFIG_KERNEL_DELAY_OBJECT_U32=1
    -DCONFIG_KERNEL_SCHEDULER_DEBUG=0
    -DCONFIG_KERNEL_DEBUG=0

#_____________________________________________________________________________#

[env:DriversTimersAPI]
build_src_filter =
    ${env.build_src_filter}
    +<examples/drv-api-timers/>

build_flags = 
    ${env.build_flags}
    -DCONFIG_MAIN_STARTUP_INTERRUPT_POLICY=1
    -DCONFIG_STDIO_PRINTF_TO_USART=0
    -DCONFIG_KERNEL_UPTIME=1
    -DCONFIG_KERNEL_SYSLOCK_HW_TIMER=0
    -DCONFIG_DRIVERS_TIMER2_API=1
    -DCONFIG_DRIVERS_TIMER4_API=1
    -DCONFIG_DRIVERS_TIMER5_API=1